---
sidebar_position: 5
title: POST /observe
description: Log an observation to TrustScope
---

# POST /observe

Log an action, LLM call, or event to TrustScope.

## Endpoint

```
POST https://api.trustscope.ai/v1/observe
```

## Request

### Headers

| Header | Required | Description |
|--------|----------|-------------|
| `Authorization` | Yes | `Bearer ts_live_xxx` |
| `Content-Type` | Yes | `application/json` |

### Body

```json
{
  "agent_id": "my-agent",
  "session_id": "sess_123",
  "action_type": "llm_call",
  "provider": "openai",
  "model": "gpt-4o",
  "input": {
    "messages": [
      {"role": "system", "content": "You are a helpful assistant"},
      {"role": "user", "content": "Hello!"}
    ]
  },
  "output": {
    "content": "Hi there! How can I help you today?",
    "finish_reason": "stop"
  },
  "metrics": {
    "input_tokens": 15,
    "output_tokens": 12,
    "latency_ms": 234,
    "cost_usd": 0.00045
  },
  "metadata": {
    "user_id": "user_456",
    "environment": "production"
  },
  "timestamp": "2026-01-31T12:00:00Z"
}
```

### Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `agent_id` | string | Yes | Unique identifier for the agent |
| `session_id` | string | No | Session to group related traces |
| `action_type` | string | Yes | Type: `llm_call`, `tool_call`, `decision`, `custom` |
| `provider` | string | No | LLM provider (openai, anthropic, google, etc.) |
| `model` | string | No | Model name |
| `input` | object | Yes | Input data (messages, parameters) |
| `output` | object | No | Output data (response, results) |
| `metrics` | object | No | Performance metrics |
| `metadata` | object | No | Custom metadata |
| `timestamp` | string | No | ISO 8601 timestamp (auto-generated if not provided) |

### Action Types

| Type | Use For |
|------|---------|
| `llm_call` | LLM API calls |
| `tool_call` | Tool/function executions |
| `decision` | Agent decisions |
| `custom` | Any other action |

---

## Response

### Success (201 Created)

```json
{
  "trace_id": "tr_abc123xyz",
  "status": "created",
  "timestamp": "2026-01-31T12:00:00.000Z",
  "detections": [],
  "policy_result": {
    "allowed": true,
    "policies_checked": ["content-filter", "cost-limit"]
  },
  "hash": "sha256:a1b2c3d4e5f6..."
}
```

### With Detections

```json
{
  "trace_id": "tr_def456abc",
  "status": "created",
  "timestamp": "2026-01-31T12:00:00.000Z",
  "detections": [
    {
      "type": "pii",
      "subtype": "email",
      "confidence": 0.95,
      "location": "input.messages[1].content",
      "value_redacted": "j***@example.com"
    }
  ],
  "policy_result": {
    "allowed": true,
    "policies_checked": ["content-filter"]
  },
  "hash": "sha256:f6e5d4c3b2a1..."
}
```

---

## Examples

### Python

```python
import requests

response = requests.post(
    "https://api.trustscope.ai/v1/observe",
    headers={
        "Authorization": "Bearer ts_live_xxx",
        "Content-Type": "application/json"
    },
    json={
        "agent_id": "my-agent",
        "action_type": "llm_call",
        "provider": "openai",
        "model": "gpt-4o",
        "input": {
            "messages": [{"role": "user", "content": "Hello"}]
        },
        "output": {
            "content": "Hi there!"
        }
    }
)

print(response.json())
```

### Node.js

```typescript
const response = await fetch('https://api.trustscope.ai/v1/observe', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer ts_live_xxx',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    agent_id: 'my-agent',
    action_type: 'llm_call',
    provider: 'openai',
    model: 'gpt-4o',
    input: {
      messages: [{ role: 'user', content: 'Hello' }]
    },
    output: {
      content: 'Hi there!'
    }
  })
});

const data = await response.json();
```

### cURL

```bash
curl -X POST https://api.trustscope.ai/v1/observe \
  -H "Authorization: Bearer ts_live_xxx" \
  -H "Content-Type: application/json" \
  -d '{
    "agent_id": "my-agent",
    "action_type": "llm_call",
    "provider": "openai",
    "model": "gpt-4o",
    "input": {"messages": [{"role": "user", "content": "Hello"}]},
    "output": {"content": "Hi there!"}
  }'
```

---

## Batch Endpoint

For high-throughput logging, use the batch endpoint:

```
POST https://api.trustscope.ai/v1/observe/batch
```

```json
{
  "observations": [
    {"agent_id": "agent-1", "action_type": "llm_call", ...},
    {"agent_id": "agent-1", "action_type": "tool_call", ...},
    {"agent_id": "agent-2", "action_type": "llm_call", ...}
  ]
}
```

**Limits:** Maximum 100 observations per batch, 10MB max request size.

---

## Errors

| Status | Error | Description |
|--------|-------|-------------|
| 400 | `validation_error` | Invalid request body |
| 401 | `authentication_error` | Invalid API key |
| 429 | `rate_limit_exceeded` | Too many requests |
