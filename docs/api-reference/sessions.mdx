---
sidebar_position: 7
title: Sessions API
description: Session management endpoints
---

# Sessions API

Manage sessions to group related traces.

## Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/v1/sessions` | Start a new session |
| GET | `/v1/sessions/{id}` | Get session details |
| POST | `/v1/sessions/{id}/end` | End a session |
| GET | `/v1/sessions` | List sessions |

---

## POST /sessions

Start a new session.

### Request

```bash
curl -X POST https://api.trustscope.ai/v1/sessions \
  -H "Authorization: Bearer ts_live_xxx" \
  -H "Content-Type: application/json" \
  -d '{
    "agent_id": "my-agent",
    "session_id": "custom-session-id",
    "user_id": "user_456",
    "metadata": {
      "source": "web",
      "ip": "192.168.1.1"
    }
  }'
```

### Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `agent_id` | string | Yes | Agent that owns this session |
| `session_id` | string | No | Custom ID (auto-generated if not provided) |
| `user_id` | string | No | End user identifier |
| `metadata` | object | No | Custom metadata |

### Response

```json
{
  "session_id": "custom-session-id",
  "agent_id": "my-agent",
  "user_id": "user_456",
  "status": "active",
  "created_at": "2026-01-31T12:00:00.000Z",
  "metadata": {
    "source": "web"
  }
}
```

---

## GET /sessions/{id}

Get session details including summary statistics.

### Request

```bash
curl https://api.trustscope.ai/v1/sessions/sess_123 \
  -H "Authorization: Bearer ts_live_xxx"
```

### Response

```json
{
  "session_id": "sess_123",
  "agent_id": "my-agent",
  "user_id": "user_456",
  "status": "active",
  "created_at": "2026-01-31T12:00:00.000Z",
  "updated_at": "2026-01-31T12:05:00.000Z",
  "stats": {
    "trace_count": 15,
    "total_tokens": 4500,
    "total_cost_usd": 0.045,
    "duration_ms": 300000,
    "detections": 0,
    "policy_violations": 0
  },
  "metadata": {
    "source": "web"
  }
}
```

---

## POST /sessions/{id}/end

End an active session.

### Request

```bash
curl -X POST https://api.trustscope.ai/v1/sessions/sess_123/end \
  -H "Authorization: Bearer ts_live_xxx" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "completed",
    "summary": "User inquiry resolved successfully",
    "metadata": {
      "resolution": "refund_processed",
      "satisfaction_score": 5
    }
  }'
```

### Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `status` | string | No | Final status: `completed`, `failed`, `abandoned` |
| `summary` | string | No | Human-readable summary |
| `metadata` | object | No | Additional metadata to append |

### Response

```json
{
  "session_id": "sess_123",
  "status": "completed",
  "summary": "User inquiry resolved successfully",
  "started_at": "2026-01-31T12:00:00.000Z",
  "ended_at": "2026-01-31T12:05:00.000Z",
  "duration_ms": 300000,
  "stats": {
    "trace_count": 15,
    "total_tokens": 4500,
    "total_cost_usd": 0.045,
    "llm_calls": 8,
    "tool_calls": 7,
    "detections": 0,
    "policy_violations": 0
  }
}
```

---

## GET /sessions

List sessions with filtering.

### Request

```bash
curl "https://api.trustscope.ai/v1/sessions?agent_id=my-agent&status=active&limit=20" \
  -H "Authorization: Bearer ts_live_xxx"
```

### Query Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `agent_id` | string | Filter by agent |
| `user_id` | string | Filter by user |
| `status` | string | Filter by status: `active`, `completed`, `failed` |
| `from` | ISO date | Start timestamp |
| `to` | ISO date | End timestamp |
| `limit` | int | Max results (default: 20, max: 100) |
| `cursor` | string | Pagination cursor |

### Response

```json
{
  "sessions": [
    {
      "session_id": "sess_123",
      "agent_id": "my-agent",
      "status": "active",
      "created_at": "2026-01-31T12:00:00.000Z",
      "trace_count": 15,
      "total_cost_usd": 0.045
    },
    {
      "session_id": "sess_122",
      "agent_id": "my-agent",
      "status": "completed",
      "created_at": "2026-01-31T11:00:00.000Z",
      "trace_count": 8,
      "total_cost_usd": 0.023
    }
  ],
  "cursor": "eyJsYXN0X2lkIjoiMTIyIn0=",
  "has_more": true
}
```

---

## Session Graph

For complex multi-agent sessions, get the interaction graph:

```bash
curl https://api.trustscope.ai/v1/sessions/sess_123/graph \
  -H "Authorization: Bearer ts_live_xxx"
```

```json
{
  "session_id": "sess_123",
  "nodes": [
    {"id": "user", "type": "user"},
    {"id": "orchestrator", "type": "agent"},
    {"id": "researcher", "type": "agent"},
    {"id": "writer", "type": "agent"}
  ],
  "edges": [
    {"from": "user", "to": "orchestrator", "count": 1},
    {"from": "orchestrator", "to": "researcher", "count": 2},
    {"from": "researcher", "to": "orchestrator", "count": 2},
    {"from": "orchestrator", "to": "writer", "count": 1},
    {"from": "writer", "to": "orchestrator", "count": 1},
    {"from": "orchestrator", "to": "user", "count": 1}
  ]
}
```

---

## SDK Usage

### Python

```python
from trustscope import TrustScope

ts = TrustScope(api_key="ts_live_xxx")

# Context manager (auto-ends session)
with ts.session(agent_id="my-agent", session_id="user_123") as session:
    # All actions automatically part of session
    result1 = my_agent("First message")
    result2 = my_agent("Second message")

print(f"Session completed: {session.id}, traces: {session.trace_count}")
```

### Node.js

```typescript
import { TrustScope } from '@trustscope/sdk';

const ts = new TrustScope({ apiKey: 'ts_live_xxx' });

const session = ts.startSession({
  agentId: 'my-agent',
  sessionId: 'user_123'
});

await session.logAction('user_message', { content: 'Hello' });
// ... more actions
await session.end({ status: 'completed' });
```
