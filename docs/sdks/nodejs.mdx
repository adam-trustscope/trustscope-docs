---
sidebar_position: 2
title: Node.js SDK
description: TypeScript-first Node.js SDK with OpenTelemetry support
---

# Node.js SDK

The TrustScope Node.js SDK provides TypeScript-first integration with full type safety, OpenTelemetry support, and framework integrations.

## Installation

```bash
npm install @trustscope/node
# or
yarn add @trustscope/node
# or
pnpm add @trustscope/node

# For OpenTelemetry support:
npm install @opentelemetry/api @opentelemetry/sdk-trace-base
```

**Requirements:** Node.js 18+

---

## Quick Start

```typescript
import { TrustScope } from '@trustscope/node';

const ts = new TrustScope({ apiKey: 'ts_live_...' });

// Create a trace
const trace = await ts.traces.create({
  agentId: 'my-agent',
  action: 'llm_call',
  input: { prompt: '...' },
  output: { response: '...' }
});

console.log(trace.id, trace.outcome);
```

---

## Client Configuration

```typescript
import { TrustScope } from '@trustscope/node';

const ts = new TrustScope({
  apiKey: 'ts_live_...',           // Required
  environment: 'live',              // live or test
  baseUrl: 'https://api.trustscope.ai',
  timeout: 30000,                   // milliseconds
  retryCount: 3,
  retryDelay: 1000,
  failOpen: true,                   // Allow on error
  debug: false
});
```

### Environment Variables

```bash
export TRUSTSCOPE_API_KEY="ts_live_..."
export TRUSTSCOPE_ENVIRONMENT="live"
```

```typescript
// Auto-configure from environment
const ts = new TrustScope();
```

---

## OpenTelemetry Integration

TrustScope SDK can emit OpenTelemetry spans for compatibility with existing observability infrastructure.

### OTel Exporter

```typescript
import { TrustScope } from '@trustscope/node';
import { OTelExporter, withOTel } from '@trustscope/node/otel';

// Configure OTel to send to TrustScope
const exporter = new OTelExporter({ apiKey: 'ts_live_...' });
await exporter.start();

// Get tracer and use OTel API
const tracer = await exporter.getTracer();
const span = tracer.startSpan('process-request');
span.setAttribute('user_id', '123');
span.end();
```

### Wrap Client with OTel Emission

```typescript
import { TrustScope } from '@trustscope/node';
import { withOTel } from '@trustscope/node/otel';

// Wrap client to emit OTel spans
const client = withOTel(new TrustScope({ apiKey: 'ts_live_...' }));

// Calls emit both TrustScope traces and OTel spans
await client.monitor({ agentId: 'my-agent', action: 'process' });
```

### OTel Configuration

```typescript
import { OTelExporter } from '@trustscope/node/otel';

const exporter = new OTelExporter({
  apiKey: 'ts_live_...',
  serviceName: 'my-ai-service',
  endpoint: 'https://api.trustscope.ai/otel/v1/traces',
  batchSize: 512,
  exportIntervalMs: 5000,
});

await exporter.start();

// Cleanup on shutdown
process.on('SIGTERM', () => exporter.shutdown());
```

---

## TypeScript Support

Full TypeScript support with type definitions:

```typescript
import {
  TrustScope,
  Trace,
  Agent,
  Policy,
  Session,
  GovernanceReceipt
} from '@trustscope/node';

const ts = new TrustScope({ apiKey: 'ts_live_...' });

const trace: Trace = await ts.traces.create({
  agentId: 'my-agent',
  action: 'llm_call',
  input: { prompt: '...' },
  output: { response: '...' }
});
```

---

## Traces API

### Create Trace

```typescript
const trace = await ts.traces.create({
  agentId: 'my-agent',
  action: 'llm_call',
  input: { prompt: '...' },
  output: { response: '...' },
  metadata: {
    model: 'gpt-4',
    tokensIn: 150,
    tokensOut: 200,
    costUsd: 0.012
  },
  sessionId: 'sess_...'
});

console.log(trace.id);              // tr_xyz789
console.log(trace.outcome);         // success, blocked, alerted
console.log(trace.governanceReceipt);
```

### List Traces

```typescript
const traces = await ts.traces.list({
  agentId: 'my-agent',
  outcome: 'blocked',
  startDate: '2026-02-01',
  endDate: '2026-02-09',
  limit: 50,
  offset: 0
});

for (const trace of traces) {
  console.log(`${trace.id}: ${trace.outcome}`);
}
```

### Get Trace

```typescript
const trace = await ts.traces.get('tr_xyz789');
console.log(trace.detections);
console.log(trace.policyEvaluations);
```

### Get Receipt (Govern)

```typescript
const receipt = await ts.traces.getReceipt('tr_xyz789');
console.log(receipt.checksRequired);
console.log(receipt.checksExecuted);
console.log(receipt.coverageScore);
```

---

## Agents API

### Create Agent

```typescript
const agent = await ts.agents.create({
  name: 'Customer Support Bot',
  metadata: { team: 'support' }
});

console.log(agent.id);
console.log(agent.fingerprint);
```

### List Agents

```typescript
const agents = await ts.agents.list({
  status: 'connected_live',
  limit: 50
});

for (const agent of agents) {
  console.log(`${agent.name}: ${agent.status}`);
}
```

### Get Agent

```typescript
const agent = await ts.agents.get('agent_abc123');
console.log(agent.dna);
console.log(agent.traceCount);
```

### Lock/Unlock (Enforce+)

```typescript
await ts.agents.lock('agent_abc123');
await ts.agents.unlock('agent_abc123');
```

### Agent DNA (Protect+)

```typescript
const dna = await ts.agents.getDna('agent_abc123');
console.log(dna.strands);

// Freeze DNA baseline
await ts.agents.freezeDna('agent_abc123');

// Get drift
const drift = await ts.agents.getDrift('agent_abc123');
console.log(drift.score);
```

---

## Policies API

### Create Policy (Protect+)

```typescript
const policy = await ts.policies.create({
  name: 'Daily Cost Limit',
  type: 'max_value',
  agents: ['agent_abc123'],
  config: {
    field: 'daily_cost_usd',
    max: 100.00,
    action: 'block'
  }
});

console.log(policy.id);
```

:::tip PII Protection
To block PII, configure the `pii_scanner` **detection engine** (not a policy).
See [Detection Engines](/docs/reference/detections) for configuration.
:::

### List Policies

```typescript
const policies = await ts.policies.list({
  type: 'max_value',
  enabled: true
});
```

### Enable/Disable

```typescript
await ts.policies.enable('pol_abc123');
await ts.policies.disable('pol_abc123');
```

### Test Policy

```typescript
const result = await ts.policies.test({
  policyId: 'pol_abc123',
  testData: {
    input: 'My SSN is 123-45-6789',
    agentId: 'agent_abc123'
  }
});

console.log(result.wouldBlock);     // true
console.log(result.detections);
```

---

## Sessions API

### Create Session

```typescript
const session = await ts.sessions.create({
  agents: ['agent_abc123'],
  metadata: { conversationId: '...' }
});
```

### End Session

```typescript
await ts.sessions.end('sess_abc123');
```

### Get Chain (Enforce+)

```typescript
const chain = await ts.sessions.getChain('sess_abc123');

for (const step of chain.steps) {
  console.log(`${step.agent} -> ${step.action}`);
}
```

---

## Governance API (Govern)

### Verify Coverage

```typescript
const verification = await ts.governance.verify('tr_xyz789');

console.log(verification.checksRequired);
console.log(verification.checksExecuted);
console.log(verification.coverageScore);
```

### Sign Receipt

```typescript
const signed = await ts.governance.signReceipt({
  receiptId: 'rcp_abc123',
  keyId: 'key_xyz789'
});

console.log(signed.signature);
```

---

## ZKP API (Govern)

### List Circuits

```typescript
const circuits = await ts.zkp.listCircuits();

for (const circuit of circuits) {
  console.log(`${circuit.id}: ${circuit.description}`);
}
```

### Generate Proof

```typescript
const proof = await ts.zkp.prove({
  circuit: 'pii_compliance',
  inputs: {
    traceIds: ['tr_abc123', 'tr_def456']
  }
});

console.log(proof.id);
console.log(proof.proof);
console.log(proof.publicInputs);
```

### Verify Proof

```typescript
const result = await ts.zkp.verify('prf_abc123');
console.log(result.valid);
```

---

## Evidence API (Govern)

### Create Evidence Pack

```typescript
const pack = await ts.evidence.createPack({
  name: 'Q1 2026 SOC 2 Evidence',
  framework: 'soc2_type2',
  dateRange: {
    start: '2026-01-01',
    end: '2026-03-31'
  },
  agents: ['agent_abc123']
});
```

### Finalize Pack

```typescript
const finalized = await ts.evidence.finalizePack('evp_abc123');
console.log(finalized.hash);
```

### Download Pack

```typescript
const buffer = await ts.evidence.downloadPack('evp_abc123');
fs.writeFileSync('./evidence_pack.zip', buffer);
```

---

## MCP Integration (Enforce+)

### List Servers

```typescript
const servers = await ts.mcp.listServers();

for (const server of servers) {
  console.log(`${server.name}: ${server.status}`);
}
```

### Register Server

```typescript
const server = await ts.mcp.registerServer({
  name: 'filesystem',
  command: 'npx',
  args: ['-y', '@modelcontextprotocol/server-filesystem'],
  allowed: true
});
```

### Approve/Deny

```typescript
const approvals = await ts.mcp.listPendingApprovals();

for (const approval of approvals) {
  if (shouldApprove(approval)) {
    await ts.mcp.approve(approval.id);
  } else {
    await ts.mcp.deny(approval.id, 'Not authorized');
  }
}
```

---

## Webhooks

### Create Webhook

```typescript
const webhook = await ts.webhooks.create({
  url: 'https://example.com/webhook',
  events: ['trace.blocked', 'alert.triggered'],
  secret: 'your_secret'
});
```

### Verify Webhook Signature

```typescript
import { verifyWebhookSignature } from '@trustscope/node';

const isValid = verifyWebhookSignature(
  payload,
  signature,
  secret
);
```

---

## Express Middleware

```typescript
import express from 'express';
import { trustscopeMiddleware } from '@trustscope/node/express';

const app = express();

app.use(trustscopeMiddleware({
  apiKey: 'ts_live_...',
  agentId: 'api-server',
  // Reference policies by name (created in dashboard)
  policies: ['cost-limit-api', 'rate-limit-100']
}));

app.post('/api/chat', async (req, res) => {
  // Request automatically traced and policies enforced
  // ...
});
```

---

## Error Handling

```typescript
import {
  TrustScope,
  TrustScopeError,
  AuthenticationError,
  RateLimitError,
  TierRequiredError,
  ValidationError
} from '@trustscope/node';

try {
  const trace = await ts.traces.create({...});
} catch (error) {
  if (error instanceof AuthenticationError) {
    console.log('Invalid API key');
  } else if (error instanceof RateLimitError) {
    console.log(`Retry after ${error.retryAfter}s`);
  } else if (error instanceof TierRequiredError) {
    console.log(`Requires ${error.requiredTier} tier`);
  } else if (error instanceof ValidationError) {
    console.log(`Invalid: ${error.errors}`);
  } else if (error instanceof TrustScopeError) {
    console.log(`Error: ${error.message}`);
  }
}
```

---

## Configuration Options

```typescript
const ts = new TrustScope({
  apiKey: 'ts_live_...',

  // Connection
  baseUrl: 'https://api.trustscope.ai',
  timeout: 30000,

  // Retry
  retryCount: 3,
  retryDelay: 1000,
  retryBackoff: 2,

  // Behavior
  failOpen: true,
  debug: false,

  // BYOLLM
  byollm: {
    provider: 'openai',
    apiKey: 'your_openai_key'
  }
});
```

---

## Testing

```typescript
import { MockTrustScope } from '@trustscope/node/testing';

const ts = new MockTrustScope();

ts.mockTraceCreate({
  outcome: 'blocked',
  detections: [{ type: 'pii', value: 'ssn' }]
});

const trace = await ts.traces.create({...});
expect(trace.outcome).toBe('blocked');
```

---

## Next Steps

- [Python SDK](/docs/sdks/python) - Python integration
- [React Native SDK](/docs/sdks/react-native) - Mobile SDK
- [API Reference](/docs/api-reference/overview) - Direct REST API
- [Framework Integrations](/docs/frameworks/overview) - LangChain, etc.
